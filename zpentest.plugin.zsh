########## Plugin: zpentest ##########
# ----------------------------------------#
########## Author: Doc0x1 ##########
########## Version: 1.0 ##########
# ----------------------------------------#
########## github.com/Doc0x1 ##########
########## TikTok: @twohackers ##########
# ----------------------------------------#

#$ To make my CTF solving life way fucking easier
penteston() {
    # Determine the location of .zshrc
    ZSHRC_LOCATION="${ZDOTDIR:-$HOME}/.zshrc"

    # Check if .zshrc exists
    if [ ! -f "$ZSHRC_LOCATION" ]; then
        printf "Error: .zshrc not found at $ZSHRC_LOCATION. Please create it first.\n"
        return 1
    fi

    # Check IP Address if provided
    if [[ $# -eq 1 ]]; then
        if [[ $1 =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            export IP=$1
            if grep -q 'export IP=' "$ZSHRC_LOCATION"; then
                sed -i "s/export IP=.*/export IP=$IP/" "$ZSHRC_LOCATION"
            else
                echo "export IP=$IP" >>"$ZSHRC_LOCATION"
            fi
            printf "Setting IP variable to $IP\n"
        else
            printf "Error: Invalid IP address format.\n"
            return 1
        fi
    else
        printf "No target IP specified. Specify an IP address to set the IP variable.\n"
        printf "Usage: penteston <IP>\n"
    fi

    # Get tun0 IP address from ifconfig output
    export TUNIP=$(ifconfig | grep -i -A 1 tun0 | tail -n 1 | awk ' { print $2 }')

    # Make sure TUNIP variable is not empty
    if [[ -z "$TUNIP" ]]; then
        printf "Error: Couldn't set TUNIP variable with tun0 IP address.\n"
        return 1
    fi

    if grep -q 'export TUNIP=' "$ZSHRC_LOCATION"; then
        sed -i "s/export TUNIP=.*/export TUNIP=$TUNIP/" "$ZSHRC_LOCATION"
    else
        echo "export TUNIP=$TUNIP" >>"$ZSHRC_LOCATION"
    fi
    printf "Setting TUNIP variable to $TUNIP\n"
}

#$ Use this function when done with the CTF
pentestoff() {
    # Determine the location of .zshrc
    ZSHRC_LOCATION="${ZDOTDIR:-$HOME}/.zshrc"

    # Check if .zshrc exists
    if [ ! -f "$ZSHRC_LOCATION" ]; then
        printf "Error: .zshrc not found at $ZSHRC_LOCATION.\n"
        return 1
    fi

    # Unset variables and remove from .zshrc
    unset IP TUNIP
    sed -i '/export IP=/d' "$ZSHRC_LOCATION"
    sed -i '/export TUNIP=/d' "$ZSHRC_LOCATION"
    printf "Unset IP and TUNIP variables and removed them from $ZSHRC_LOCATION\n"
}
